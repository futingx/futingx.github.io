---
layout: post
title:  "计算机网络"
categories: 计算机网络  # 文章类别
tags:  计算机网络 #文章标签
author: FTX #作者
---

* content
{:toc}

# 计算机网络（第八版）谢希仁

##  简介
《计算机网络》（第八版）由谢希仁编著，是一本系统介绍计算机网络基础理论与实践的经典教材。

##  内容概述
### [1. 网络层](#jumpone)
### [2. 传输层](#jumptwo)
### [3. 网络安全](#jumpthree)





## <span id="jumpone">1.网络层</span>
### 1.1 IP地址与子网划分
#### IP地址

#### 作用

- 用于决定数据包最终到达哪个计算机

#### 组成

* 由32位比特组成，即4个字节
* 这32位可以分为两个部分，称为网络号和主机号
* 同一网段的计算机网络号相同，路由器负责连接不同的网段，而交换机负责连接同一网段中不同的计算机
* 同一网段的计算机主机号不同
* 计算机在和其他计算机进行通信之前需要判断目标IP和自己的IP网络是否相同
  * 相同，则目标MAC地址写目标计算机的MAC地址
  * 不同，则目标MAC地址写本网段的路由器的MAC地址

#### 表示方法

* 二进制表示法

  11111111.10110011.11101000.10010010

* 点分十进制法

  192.168.1.122

#### 分类

* A，B，C：用于日常使用
* D：用于组(多)播
* E：保留，目前还没用

![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E5%92%AF%E5%B1%82/01.%20IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/images/%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.jpg)



### 子网掩码

#### 作用

* 用于计算IP地址的网络号和主机号

#### 组成

* 表示网络号的位置全1，表示主机号的位置全0
* 比如C类地址：192.168.1.125，其子网掩码为 255.255.0.0

#### 原理

* 子网掩码与计算地址进行与计算，全1才1，有0则0
* 则计算结果网络号原样输出，主机号全为0

#### 分类

* A类：255.0.0.0
* B类：255.255.0.0
* C类：255.255.255.0
* D类：没有子网掩码
* E类：没有子网掩码



### 特殊地址

* 网段地址：主机号全0
* 广播地址：主机号全1
* 回环地址：127.0.0.1，只要装了TCP/IP就行，不需要经过网卡
* 回送地址：127.x.x.x
* 冲突地址：0.0.0.0，如果本机的IP和本网段中其他计算机相同(冲突)，则为0.0.0.0，子网掩码为0.0.0.0



### 公网内网

#### 公网

* 由美国机构 Inter NIC 负责，各国各级 ISP 使用的公网需要向Inter NIC申请

#### 内网

* 局域网

* A类：10.0.0.0/255.0.0.0
* B类：172.16.0.0/255.255.0.0 - 172.31.0.0/255.255.0.0
* C类：192.168.0.0/255.255.255.0 - 192.168.255.0/255.255.255.0

#### NAT/PAT

* 内网地址访问 Internet 需要 NAT/PAT 技术

* NAT：网络地址转换
  * 所有使用本地地址的主机在和外界通信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和因特网连接
* PAT：端口地址转换
  * 在使用NAT时，如果只有一个公有IP，而有多个内部IP，这个时候NAT就要通过映射不同的端口来跟踪记录不同的会话
  * 则NAT会将用户A、B、C访问分别映射到1088、1098、23100【举例】，此时实际上就是PAT了



### 子网划分

#### 概念

* 子网划分就是利用现有网段的主机号的头几位作为网络号，这些位置称为子网号，子网号的概念只存在于分类编址

#### 作用

* 减少地址浪费

#### 注意

* 子网只能等分
* 主机号全为0不能用，因为这表示网段
* 主机号全为1不能用，因为这是广播地址
* 因此能用的主机号范围是 [差点全0，差点全1]

#### 例子

![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E5%92%AF%E5%B1%82/01.%20IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/images/%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86.jpeg)



### 无分类编制

#### 概念

* 不分类了，只分网络号和主机号
* 通过子网掩码确定网络号和主机号

#### CIDR记法

* 一个无分类编制的IP地址为   

  11100110110010101001010101110101

  | 含义         | 网络号 | 主机号                     |
  | ------------ | ------ | -------------------------- |
  | 无分类编制IP | 111001 | 10110010101001010101110101 |
  | 子网掩码     | 111111 | 00000000000000000000000000 |

* CIDR记法为

  230.202.149.117/6

  其中6表示子网掩码的前6位是1，其他为0

#### 例子



![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E5%92%AF%E5%B1%82/01.%20IP%E5%9C%B0%E5%9D%80%E4%B8%8E%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86/images/%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%88%B6.jpeg)

### 1.2 静态路由与动态路由
### 网络畅通的条件

* 数据报包有去有回
* 网络中的路由器必须知道且只需要知道下一跳的地址【路由器只要知道下一跳地址就行，不必知道如何到达任意的路由器，因为如果要实现，路由表将非常非常巨大，这是不可能的】



### 静态路由

* 静态路由是指网络管理员手动构建路由器的路由表，告诉路由器下一跳的地址
* 对于路由器，直连的网段不用加路由信息，自动识别



### 静态路由汇总

* 静态路由汇总需求分析

* * 如果A网段和B网段都有很多的计算机，那么A网段为了与B网段联通，则需要在A网关填写B网段中所有的IP地址，则需要在B网关填写A网段中所有的IP地址，这是不实际的
  * 比如北京市的所有计算机想要和石家庄的计算机网络连通，则北京市总路由要写石家庄网段所有的IP地址，石家庄总路由要写北京市网段所有的IP地址，这是不实际的
  * 为了简化路由表，需要将多条路由合并为一条，为此引出静态路由汇总

* 路由汇总实现

  * A网关将所有去往B网段的静态路由配置为B的网关地址，B网关将所有去往A网段的静态路由配置为A的网关地址，从而实现路由汇总

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/02.%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/images/%E5%9B%BE1.PNG)

* 匹配顺序：优先匹配子网掩码大的网段，因为掩码大的网段范围小

```
172.16.1.0 / 255.255.255.0     10.0.0.2  优先度：A
172.16.0.0 / 255.255.0.0       10.0.0.2  优先度：B
172.0.0.0  / 255.0.0.0         10.0.0.2  优先度：C
0.0.0.0    / 0.0.0.0           10.0.0.2  优先度：D
```

* 默认路由

  * 最大网段：0.0.0.0 / 0.0.0.0，这个网段代表互联网

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/02.%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/images/%E5%9B%BE2.PNG)

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/02.%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/images/%E5%9B%BE3.PNG)

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/02.%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/images/%E5%9B%BE4.PNG)



### 动态路由

* 动态路由是指路由器能够自动地构建自己的路由表，并且能根据实际情况动态发生改变



### 动态路由协议 - RIP

* RIP协议特点

  * RIP每30秒发送一次自己的路由表，从而进行路由表更新
  * 选择到达目标网络所经过路由器最少的路径为最佳路径，即最小跳数
  * 默认允许的最大跳数为15跳，即认为16跳或以上的路由器是不可达的
  * RIP适合小型网络，不适合大型网络

* RIP工作原理

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/02.%20%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E4%B8%8E%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1/images/%E5%9B%BE5.PNG)



### 动态路由协议 - OSPF

* 开放最短路径协议


### 1.3 IP协议簇

## IP协议

### IP协议全称

* Internet Protocol
* 互联网互连协议

### IP协议作用

* 实现数据在网络节点上互相传输

### IP协议特点

* 不面向连接
* 不保证可靠

### IP协议数据报结构

![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/03.%20IP%E5%8D%8F%E8%AE%AE%E7%B0%87/images/IP%E5%8D%8F%E8%AE%AE%E6%95%B0%E6%8D%AE%E6%8A%A5.PNG)

| 组成     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 版本     | 目前有IPv4和IPv6两种版本                                     |
| 首部长度 | 单位4字节，所以首部长度最大为 15 * 4 = 60字节                |
| 区分服务 | 不同服务的优先级不同，从而保证服务质量保证(QoS)              |
| 总长度   | IP首部与数据部分字节之和，最大为 2^16-1个字节                |
| 片偏移   | 占13位，本分片再原始数据报文中相对首位的偏移位               |
| 生存时间 | TTL，指数据包跳转次数剩余，最多255跳                         |
| 协议     | 指明上层使用的协议，从而确定要给哪个进程                     |
| 标识     | IP协议软件中的一个数，用于唯一标识主机发送的数据报<br />在发出IP报文时，每个分片会被分配一个数<br />每分配一个报文，这个数加1，溢出则从0开始算<br />标识用于分片达到目的主机后进行重组 |
| 标志     | 最低位(MF)：MF=1表示后面还有分片，MF=0表示已经是最后一个分片<br />中间位(DF)：DF=1表示不允许分片，DF=0表示允许分片 |

* 片偏移计算

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/03.%20IP%E5%8D%8F%E8%AE%AE%E7%B0%87/images/%E7%89%87%E5%81%8F%E7%A7%BB%E8%AE%A1%E7%AE%97.PNG)

* 片偏移示例

  ![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/03.%20IP%E5%8D%8F%E8%AE%AE%E7%B0%87/images/%E7%89%87%E5%81%8F%E7%A7%BB%E7%A4%BA%E4%BE%8B.PNG)



## ICMP协议

### ICMP协议全称

* Internet Control Message Protocol - 互联网控制报文协议

### ICMP协议作用

* 用于主机、路由器之间传递控制信息
* 控制信息指：网络是否流畅，路由器是否可用，主机是否可达

### ICMP协议使用

* ICMP数据报一般被TCP/UDP协议使用，也可以被用户进程使用
* 命令行使用：`trace IP地址`，即可看到IP数据包沿途所经过的路由器的信息

### ICMP协议数据报传输

* ICMP报文被封装再IP数据报内，随IP数据报进行传输

![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/03.%20IP%E5%8D%8F%E8%AE%AE%E7%B0%87/images/ICMP%E6%95%B0%E6%8D%AE%E6%8A%A5.PNG)

### ICMP报文类型和代码

![](https://github.com/gothicrush/learning/blob/master/Network/04.%20%E7%BD%91%E7%BB%9C%E5%B1%82/03.%20IP%E5%8D%8F%E8%AE%AE%E7%B0%87/images/ICMP%E6%8A%A5%E6%96%87%E7%B1%BB%E5%9E%8B.PNG)



## ARP协议

### ARP协议全称

* Address Resolution Protocol
* 地址解析协议

### ARP协议作用

* 用于将以太网（局域网）中的IP地址解析为MAC地址
* 因为当一个IP数据报来到一个局域网时，它不知道应该去哪个计算机，于是使用ARP协议发出一个广播，内容是`你们谁的IP地址是xxx.xxx.xxx.xxx的，告诉我你的MAC地址，我发数据给你`，目标计算机收到广播后，用ARP协议广播`我是啊，我的MAC地址是yyyy`
* 点到点链路使用PPP协议，不需要ARP协议

### ARP协议使用

* 命令行使用：`arp -a`，看到本机存储的`IP地址 <--> MAC地址`的映射表



## IGMP协议

### IGMP协议全称

* Internet Group Manage Protocol
* 互联网组管理协议

### IGMP协议作用

* 用于组播功能的实现
* 主机通过IGMP协议通知路由器希望接收或离开某个特定的组播组
* 路由器通过IGMP协议周期性查询组播组中成员状态，维护组播组中成员的关系

### 组播是什么

* 在发送者与每一个接收之间实现一对多的网络连接
* 如果发送者需要给多个接收者发送相同的数据，只需要发送一份数据就行
* 不用针对每个接收方都发送一份，提高了通信效率，减少资源使用

